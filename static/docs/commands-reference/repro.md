# repro

Reproduce complete or partial [pipelines](/doc/commands-reference/pipeline) by
executing commands defined in their [stages](/doc/commands-reference/run), in
the correct order. The commands to be executed are determined by recursively
analyzing dependencies and outputs of the target stages.

## Synopsis

```usage
usage: dvc repro [-h] [-q | -v] [-f] [-s] [-c CWD] [-m] [--dry] [-i]
                 [-p] [-P] [-R] [--ignore-build-cache] [--no-commit]
                 [--downstream] [targets [targets ...]]

positional arguments:
  targets               DVC-file to reproduce. 'Dvcfile' by default.
```

## Description

`dvc repro` provides an way to regenerate data pipeline results, by restoring
the dependency graph (a
[DAG](https://en.wikipedia.org/wiki/Directed_acyclic_graph)) implicitly defined
by [stage files](/doc/commands-reference/run) (DVC-files with dependencies) that
are found in the <abbr>project</abbr>. The commands defined in these stages can
then be executed in the correct order, reproducing pipeline results.

> Pipeline stages are typically defined using the `dvc run` command, while
> initial data dependencies can be registered by the `dvc add` command.

There's a few ways to restrict the stages that will be regenerated by this
command: by specifying stage file `targets`, or by using the `--single-item`,
`--cwd`, or other options.

If specific [DVC-files](/doc/user-guide/dvc-file-format) (`targets`) are
omitted, `Dvcfile` will be assumed.

By default, this command recursively searches in pipeline stages, starting from
the `targets`, to determine which ones have changed. Then it executes the
corresponding commands.

`dvc repro` does not run `dvc fetch`, `dvc pull` or `dvc checkout` to get data
files, intermediate or final results. It saves all the data files, intermediate
or final results into the <abbr>DVC cache</abbr> (unless `--no-commit` option is
specified), and updates stage files with the new checksum information.

## Options

- `-f`, `--force` - reproduce a pipeline, regenerating its results, even if no
  changes were found. By default this executes all of its stages but it can be
  limited with the `targets` argument and `-s`, `-p`, or `-c` options.

- `-s`, `--single-item` - reproduce only a single stage by turning off the
  recursive search for changed dependencies. Multiple stages are executed
  (non-recursively) if multiple stage files are given as `targets`.

- `-c`, `--cwd` - directory within the project to reproduce from. If no
  `targets` are given, it attempts to use `Dvcfile` in the specified directory.
  Instead of using `--cwd`, one can alternately specify a target in a
  subdirectory as `path/to/target.dvc`. This option can be useful for example
  with subdirectories containing a separate pipeline that can either be
  reproduced as part of the pipeline in the parent directory, or as an
  independent unit.

- `-R`, `--recursive` - `targets` is expected to contain at least one directory
  path for this option to have effect. Determines the stages to reproduce by
  searching each target directory and its subdirectories for DVC-files to
  inspect.

- `--no-commit` - do not save outputs to cache. (See `dvc run`.) Useful when
  running different experiments and you don't want to fill up the cache with
  temporary files. Use `dvc commit` when ready to commit the results to cache.

- `-m`, `--metrics` - show metrics after reproduction. The target pipelines must
  have at least one metrics file defined either with the `dvc metrics` command,
  or by the `-M` or `-m` options on the `dvc run` command.

- `--dry` - only print the commands that would be executed without actually
  executing the commands.

- `-i`, `--interactive` - ask for confirmation before reproducing each stage.
  The stage is only executed if the user types "y".

- `-p`, `--pipeline` - reproduce the entire pipelines that the stage file
  `targets` belong to. Use `dvc pipeline show <target>.dvc` to show the parent
  pipeline of a target stage.

- `-P`, `--all-pipelines` - reproduce all pipelines, for all the stage files
  present in `DVC` repository.

- `--ignore-build-cache` - in cases like `... -> A (changed) -> B -> C` it will
  reproduce `A` first and then `B` even if `B` was previously executed with the
  same inputs from `A` (cached). It might be useful when we have a common
  dependency among all stages and want to specify it once (for the stage `A`
  here). For example, if we know that all stages (`A` and below) depend on
  `requirements.txt`, we can specify it only once in `A`, omitting it in `B` and
  `C`. To be precise , it reproduces all descendants of a changed stage or the
  stages following the changed stage, even if their direct dependencies did not
  change. Like with the same option on `dvc run`, this is a way to force execute
  stages without changes. This can also be useful for pipelines containing
  stages that produce non-deterministic (semi-random) outputs. For
  non-deterministic stages the outputs can vary on each execution, meaning the
  cache cannot be trusted for such stages.

- `--downstream` - only execute the stages after the given `targets` in their
  corresponding pipelines, including the target stages themselves.

- `-h`, `--help` - prints the usage/help message, and exit.

- `-q`, `--quiet` - do not write anything to standard output. Exit with 0 if all
  stages are up to date or if all stages are successfully executed, otherwise
  exit with 1. The command defined in the stage is free to write output
  irregardless of this flag.

- `-v`, `--verbose` - displays detailed tracing information.

## Examples

For simplicity, let's build a pipeline defined below. (If you want get your
hands on something more real, see this shot
[pipeline tutorial](/doc/get-started/example-pipeline)). It takes this
`text.txt` file:

```
dvc
1231
is
3
the
best
```

And runs a few simple transformations to filter and count numbers:

```dvc
$ dvc run -f filter.dvc -d text.txt -o numbers.txt \
           "cat text.txt | egrep '[0-9]+' > numbers.txt"

$ dvc run -f Dvcfile -d numbers.txt -d process.py -M count.txt \
           "python process.py numbers.txt > count.txt"
```

> Note that using `-f Dvcfile` with `dvc run` above is optional, the stage file
> name would otherwise default to `count.txt.dvc`. We use `Dvcfile` in this
> example because that's the default stage file name `dvc repro` will read
> without having to provide any `targets`.

Where `process.py` is a script which for simplicity just prints the number of
lines:

```python
import sys
num_lines = 0
with open(sys.argv[1], 'r') as f:
    for line in f:
        num_lines += 1
print(num_lines)
```

The result of executing these `dvc run` commands should look like this:

```dvc
$ tree
.
├── Dvcfile        <---- second stage with a default DVC name
├── count.txt      <---- result: "2"
├── filter.dvc     <---- first stage
├── numbers.txt    <---- intermediate result of the first stage
├── process.py     <---- code that implements data transformation
└── text.txt       <---- text file to process
```

You may want to check the contents of `Dvcfile` and `count.txt` for later
reference.

Ok, now, let's run the `dvc repro` command (remember, by default it reproduces
outputs defined in `Dvcfile`, `count.txt` in this case):

```dvc
$ dvc repro
WARNING: assuming default target 'Dvcfile'.
Stage 'filter.dvc' didn't change.
Stage 'Dvcfile' didn't change.
Data and pipelines are up to date.
```

It makes sense, since we haven't changed neither of the dependencies this
pipeline has: `text.txt` or `process.py`. Now, let's imagine we want to print a
description and we add this line to the `process.py`:

```python
...
print('Number of lines:')
print(num_lines)
```

If we now run `dvc repro`, that's what we should see:

```dvc
$ dvc repro
WARNING: assuming default target 'Dvcfile'.
Stage 'filter.dvc' didn't change.
Stage 'Dvcfile' changed.
Reproducing 'Dvcfile'
Running command:
  python process.py numbers.txt > count.txt
Output 'count.txt' doesn't use cache. Skipping saving.
Saving information to 'Dvcfile'.
```

You can now check that `Dvcfile` and `count.txt` have been updated with the new
information, new `md5` checksums and a new result respectively.

## Example: Downstream

The `--downstream` option allows us to only reproduce results from commands
after a specific stage in a pipeline. To demonstrate how it works, let's make a
change in `text.txt` (the input of our first stage, defined in the previous
example):

```
...
The answer to universe is 42
- The Hitchhiker's Guide to the  Galaxy
```

Now, using the `--downstream` option results in the following output:

```dvc
$ dvc repro --downstream
WARNING: assuming default target 'Dvcfile'.
Stage 'Dvcfile' didn't change.
Data and pipelines are up to date.
```

The reason being that the `text.txt` is a file which is a dependency in the
target DVC-file (`Dvcfile` by default). Instead, it's dependent on `filter.dvc`,
which happens before the target stage in this pipeline (shown above in the
following figure).

```dvc
$ dvc pipeline show --ascii

    .------------.
    | filter.dvc |
    `------------'
           *
           *
           *
      .---------.
      | Dvcfile |
      `---------'
```
